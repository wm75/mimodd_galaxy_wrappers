<tool id="mimodd_header" name="MiModD Run Annotation" version="@MIMODD_WRAPPER_VERSION@">
    <description>
    writes run metadata in SAM format for attaching it to sequenced reads data
    </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />
    <command><![CDATA[
  	mimodd header
	    --rg-id '$rg_id'
	    --rg-sm '$rg_sm'
	  #if $str($rg_cn):
		--rg-cn '$rg_cn'
	  #end if
	  #if $str($rg_ds):
		--rg-ds '$rg_ds'
	  #end if	
	  #if $str($rg_date):
		--rg-dt '$rg_date'
	  #end if
	  #if $str($rg_lb):
		--rg-lb '$rg_lb'
	  #end if
	  #if $str($rg_pl):
		--rg-pl '$rg_pl'
	  #end if
	  #if $str($rg_pi):
		--rg-pi '$rg_pi'
	  #end if
	  #if $str($rg_pu):
		--rg-pu '$rg_pu'
	  #end if
	    --ofile '$ofile'

    ]]></command>

    <inputs>
        <param name="rg_id" type="text" size="80"
        label="read-group ID (required)">
            <validator type="empty_field" />
            <sanitizer invalid_char="">
                <valid initial="string.printable">
                    <remove value="&quot;" />
                </valid>
                <mapping initial="none">
                    <add source="&quot;" target="\&quot;"/>
                </mapping>
            </sanitizer>
        </param>
        <param name="rg_sm" type="text" size="80"
        label="sample name (required)">
            <validator type="empty_field" />
            <sanitizer invalid_char="">
                <valid initial="string.printable">
                    <remove value="&quot;" />
                </valid>
                <mapping initial="none">
                    <add source="&quot;" target="\&quot;"/>
                </mapping>
            </sanitizer>
        </param>
        <param name="rg_ds" type="text" size="80" label="description">
            <sanitizer invalid_char="">
                <valid initial="string.printable">
                    <remove value="&quot;" />
                </valid>
                <mapping initial="none">
                    <add source="&quot;" target="\&quot;"/>
                </mapping>
            </sanitizer>
        </param>
        <param name="rg_date" type="text"
        label="date (YYYY-MM-DD) the run was produced">
            <validator type="expression" message="YYYY-MM-DD date format required">not value or (len(value.split('-')) == 3 and all(part.isdigit() and len(part)==expect_len for part, expect_len in zip(value.split('-'), [4,2,2])))</validator>
        </param>
        <param name="rg_cn" type="text" size="80"
        label="name of sequencing center">
            <sanitizer invalid_char="">
                <valid initial="string.printable">
                    <remove value="&quot;" />
                </valid>
                <mapping initial="none">
                    <add source="&quot;" target="\&quot;"/>
                </mapping>
            </sanitizer>
        </param>
        <param name="rg_lb" type="text" size="80" label="read-group library">
            <sanitizer invalid_char="">
                <valid initial="string.printable">
                    <remove value="&quot;" />
                </valid>
                <mapping initial="none">
                    <add source="&quot;" target="\&quot;"/>
                </mapping>
            </sanitizer>
        </param>
        <param name="rg_pl" type="text"
        label="platform/technology used to produce the reads">
            <option value="ILLUMINA">ILLUMINA</option>
            <option value="PACBIO">PACBIO</option>
            <option value="IONTORRENT">IONTORRENT</option>
            <option value="ONT">ONT</option>
            <option value="LS454">LS454</option>
            <option value="SOLID">SOLID</option>
            <option value="HELICOS">HELICOS</option>
            <option value="CAPILLARY">CAPILLARY</option>
        </param>
        <param name="rg_pi" type="text" label="predicted median insert size" />
        <param name="rg_pu" type="text" size="80"
        label="platform unit; unique identifier">
            <sanitizer invalid_char="">
                <valid initial="string.printable">
                    <remove value="&quot;" />
                </valid>
                <mapping initial="none">
                    <add source="&quot;" target="\&quot;"/>
                </mapping>
            </sanitizer>
        </param>
    </inputs>

    <outputs>
        <data name="ofile" format="sam" 
        label="${rg_sm} (${rg_id}) header information from MiModd ${tool.name} on ${on_string}"/>
    </outputs>
    
    <tests>
        <test>
            <param name="rg_id" value="000" />
            <param name="rg_sm" value="N2" />
            <param name="rg_ds" value="C. elegans wt" />
            <param name="rg_date" value="2017-06-27" />
            <param name="rg_cn" value="ABC" />
            <param name="rg_lb" value="XYZ" />
            <param name="rg_pl" value="ILLUMINA" />
            <param name="rg_pi" value="400" />
            <param name="rg_pu" value="SEQ123" />
            <output name="ofile" ftype="sam" file="header_only.sam" />
        </test>
    </tests>

    <help><![CDATA[
.. class:: infomark

   **What it does**

This tool takes user-provided information about a next-generation sequencing
run and constructs a valid SAM format header from it.

The resulting dataset can be used by the *MiModD Convert*, *MiModD Reheader*
and the *MiModD Read Alignment* tool to add run metadata to sequenced reads
input datasets (or to overwrite pre-existing information).

**Note:**

**MiModD requires run metadata for every input file at the Alignment step !**

**Tip:**

While you can do Alignments from fastq file format by providing a custom header file directly to the *SNAP Read Alignment* tool, we **recommend** you to first convert all input files to and archive all datasets in SAM/BAM format with appropriate header information prior to any downstream analysis. Although a bit more time-consuming, this practice protects against information loss and ensures that the input datasets will remain useful for others in the future.

@HELP_FOOTER@
    ]]></help>
    <expand macro="citations" />
</tool>
	
